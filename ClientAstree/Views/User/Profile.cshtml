@model ClientAstree.Models.UserVM

<h2>User Profile</h2>
<div>
    <p>Email: @Model.Email</p>
    <p>First Name: @Model.FirstName</p>
    <p>Last Name: @Model.LastName</p>
    <p>Phone Number: @Model.PhoneNumber</p>
    <p>Roles: @string.Join(", ", Model.Roles)</p>
    <p>CIN: @Model.CIN</p>
    <p>Birth Date: @Model.BirthDate</p>
    <p>Nationality: @Model.Nationality</p>
    <p>Gender: @Model.Gender</p>
    <p>Civility: @Model.Civility</p>
    <!-- Add more fields as needed -->
</div>
<!-- Profile View -->
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#editProfileModal">
    Update Profile
</button>
<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" role="dialog" aria-labelledby="editProfileModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="editProfileForm" method="post">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" class="form-control" id="email" name="email" value="@Model.Email">
                    </div>
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" class="form-control" id="firstName" name="firstName" value="@Model.FirstName">
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" class="form-control" id="lastName" name="lastName" value="@Model.LastName">
                    </div>
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="tel" class="form-control" id="phoneNumber" name="phoneNumber" value="@Model.PhoneNumber">
                    </div>
                    <div class="form-group">
                        <label>CIN</label>
                        <input type="text" class="form-control" id="cin" name="cin" value="@Model.CIN">
                    </div>
  <div class="form-group">
        <label>Birth Date</label>
        <input type="date" class="form-control" id="birthDate" name="birthDate" value="@Model.BirthDate?.ToString("yyyy-MM-dd")">
    </div>
                    <div class="form-group">
                        <label>Nationality</label>
                        <input type="text" class="form-control" id="nationality" name="nationality" value="@Model.Nationality">
                    </div>
<div class="form-group">
    <label>Gender</label>
    <select class="form-control" id="gender" name="gender">
        <option value="">Select Gender</option>
        @foreach (var option in ViewBag.GenderOptions)
        {
            if (Model.Gender == option.Value)
            {
                <option value="@option.Value" selected>@option.Text</option>
            }
            else
            {
                <option value="@option.Value">@option.Text</option>
            }
        }
    </select>
</div>

<div class="form-group">
    <label>Civility</label>
    <select class="form-control" id="civility" name="civility">
        <option value="">Select Civility</option>
        @foreach (var option in ViewBag.CivilityOptions)
        {
            if (Model.Civility == option.Value)
            {
                <option value="@option.Value" selected>@option.Text</option>
            }
            else
            {
                <option value="@option.Value">@option.Text</option>
            }
        }
    </select>
</div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    $('#editProfileForm').submit(function(e) {
        e.preventDefault();  // Prevent the normal submission action

        var formData = $(this).serialize();  // Serialize the form data.

        $.ajax({
            type: 'POST',
            url: '@Url.Action("UpdateProfile", "User")',
            data: formData,
            success: function(response) {
                $('#editProfileModal').modal('hide');
                alert('Profile updated successfully!');
                // Optionally refresh the page or part of it
            },
            error: function() {
                alert('Error updating profile.');
            }
        });
    });
});
</script>
